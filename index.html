<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>pont of joint </title>
  <style>
    :root{--bg:#f6f8fa;--card:#fff;--accent:#246b50;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial; margin:0; background:var(--bg); color:#111}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:18px}
    h1{font-size:20px;margin:0}
    p.lead{margin:6px 0 18px;color:var(--muted)}

    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px}
    @media (max-width:880px){.grid{grid-template-columns:1fr;}}

    .card{background:var(--card);border-radius:10px;padding:14px;border:1px solid rgba(15,23,42,0.05);box-shadow:0 6px 18px rgba(15,23,42,0.03)}

    .image-area{display:flex;flex-direction:column;gap:12px}
    #imageCanvas{background:#fafafa;border:1px dashed #ddd;width:100%;height:auto;display:block;border-radius:6px}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn.secondary{background:#e6eef0;color:#064;}
    .btn.ghost{background:transparent;border:1px solid #e5e7eb;color:var(--muted)}

    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:left;font-size:13px}
    th{background:#fbfcfd;color:var(--muted)}

    .small{font-size:13px;color:var(--muted)}

    .result-area{display:flex;flex-direction:column;gap:12px}
    #triangleVisual{
        width:100%;
        height:420px;  /* ← 삼각형 안 잘리도록 크게 조정 */
        border-radius:6px;
        border:1px solid #eee;
        background:#fff
    }

    .tabs{display:flex;gap:6px;flex-wrap:wrap}
    .tab-btn{padding:8px 12px;border-radius:8px;background:#f3f4f6;border:none;cursor:pointer}
    .tab-btn.active{background:var(--accent);color:#fff}

    .panel{display:none}
    .panel.active{display:block}

    .form-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input[type=number]{padding:6px;border-radius:6px;border:1px solid #e6eef0;min-width:90px}

    footer{margin-top:18px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>point of joint</h1>
    </header>

    <p class="lead">이미지를 업로드한 뒤 캔버스에서 세 점(A,B,C)을 선택하면 픽셀 단위의 변 길이와 각도를 계산합니다. 코사인·사인 법칙 계산기도 포함되어 있습니다.</p>

    <div class="grid">
      <section class="card image-area" aria-labelledby="imageTitle">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <strong id="imageTitle">이미지 업로드 및 점 선택</strong>
            <div class="small">브라우저 내부에서만 처리됩니다. 서버 전송 없음.</div>
          </div>
          <div style="display:flex;gap:8px">
            <label class="btn" for="imageUpload">이미지 선택</label>
            <input id="imageUpload" type="file" accept="image/*" style="display:none">
            <button id="clearPoints" class="btn ghost">모두 지우기</button>
            <button id="deleteLastPoint" class="btn ghost">마지막 지우기</button>
          </div>
        </div>

        <canvas id="imageCanvas" width="600" height="420" role="img"></canvas>

        <div class="card" style="padding:10px">
          <strong>선택된 점 좌표</strong>
          <table>
            <thead><tr><th>점</th><th>X</th><th>Y</th></tr></thead>
            <tbody id="pointsList"><tr><td colspan="3" class="small">아직 선택된 점이 없습니다.</td></tr></tbody>
          </table>
        </div>

      </section>

      <aside class="card result-area">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <strong>삼각형 계산 결과</strong>
            <div class="small">세 점을 선택하면 자동으로 계산됩니다.</div>
          </div>
          <div style="display:flex;gap:8px">
            <button id="downloadPNG" class="btn secondary">시각화 PNG 저장</button>
            <button id="resetAll" class="btn ghost">초기화</button>
          </div>
        </div>

        <canvas id="triangleVisual" width="360" height="420"></canvas>

        <div id="triangleInfo" class="small">세 점을 선택하세요. 현재 0/3</div>

        <div style="margin-top:8px">
          <div class="tabs">
            <button class="tab-btn active" data-tab="lawsFromPoints">점→법칙</button>
            <button class="tab-btn" data-tab="cosineCalc">코사인법칙</button>
            <button class="tab-btn" data-tab="sineCalc">사인법칙</button>
          </div>

          <div id="lawsFromPoints" class="panel active" style="margin-top:10px">
            <div id="cosLawResult" class="small"></div>
            <div id="sineLawResult" class="small"></div>
          </div>

          <div id="cosineCalc" class="panel" style="margin-top:10px">
            <div class="small">코사인법칙: c² = a² + b² - 2ab·cosC</div>
            <div style="margin-top:8px">
              <div class="form-row">
                <input id="sideA1" type="number" placeholder="변 a">
                <input id="sideB1" type="number" placeholder="변 b">
                <input id="sideC1" type="number" placeholder="변 c">
                <button class="btn" id="calcAngles">각도 계산</button>
              </div>
            </div>
            <div style="margin-top:8px" id="cosineLawCalcResult"></div>
          </div>

          <div id="sineCalc" class="panel" style="margin-top:10px">
            <div class="small">사인법칙: a/sin(A) = b/sin(B) = c/sin(C)</div>
            <div style="margin-top:8px" class="form-row">
              <input id="sineSideA" type="number" placeholder="변 a">
              <input id="sineAngleA" type="number" placeholder="각 A(도)">
              <input id="sineSideB" type="number" placeholder="변 b">
              <input id="sineAngleB" type="number" placeholder="각 B(도)">
            </div>
            <div style="margin-top:8px" class="form-row">
              <input id="sineSideC" type="number" placeholder="변 c">
              <input id="sineAngleC" type="number" placeholder="각 C(도)">
              <button class="btn" id="calcSine">사인법칙 계산</button>
            </div>
            <div id="sineLawCalcResult" style="margin-top:8px" class="small"></div>
          </div>

        </div>

      </aside>
    </div>

    <footer class="card" style="margin-top:18px">
      <div><strong>사용 팁</strong></div>
      <ul style="margin:6px 0 0 18px;color:var(--muted)">
        <li>이미지 업로드 후 캔버스에서 A, B, C 순서로 클릭하세요.</li>
        <li>삼각형 시각화는 항상 중앙 정렬되어 절대 잘리지 않습니다.</li>
      </ul>
    </footer>
  </div>

  <script>
    const imageUpload = document.getElementById('imageUpload');
    const canvas = document.getElementById('imageCanvas');
    const ctx = canvas.getContext('2d');
    const triangleCanvas = document.getElementById('triangleVisual');
    const triangleCtx = triangleCanvas.getContext('2d');
    const pointsList = document.getElementById('pointsList');
    const triangleInfo = document.getElementById('triangleInfo');
    const cosLawResult = document.getElementById('cosLawResult');
    const sineLawResult = document.getElementById('sineLawResult');

    let img = null;
    let points = [];

    imageUpload.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) { alert('이미지 파일을 선택하세요.'); return; }
      const reader = new FileReader();
      reader.onload = ev => {
        img = new Image();
        img.onload = () => {
          const maxW = 900, maxH = 700;
          let w = img.width, h = img.height;
          const ratio = Math.min(1, Math.min(maxW/w, maxH/h));
          w = Math.round(w*ratio); h = Math.round(h*ratio);
          canvas.width = w; canvas.height = h;
          ctx.clearRect(0,0,w,h);
          ctx.drawImage(img,0,0,w,h);
          points = [];
          renderPointsList();
          updateTriangleInfo();
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    canvas.addEventListener('click', e => {
      if (!img) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left; 
      const y = e.clientY - rect.top;
      if (points.length >= 3) { alert('이미 3개의 점이 선택되어 있습니다.'); return; }
      points.push({x,y});
      redrawImage(); 
      renderPointsList(); 
      updateTriangleInfo();
    });

    document.getElementById('clearPoints').addEventListener('click', ()=>{
      points=[];
      redrawImage();
      renderPointsList();
      updateTriangleInfo();
    });

    document.getElementById('deleteLastPoint').addEventListener('click', ()=>{
      points.pop();
      redrawImage();
      renderPointsList();
      updateTriangleInfo();
    });

    document.getElementById('resetAll').addEventListener('click', ()=>{
      points=[];
      img=null;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      renderPointsList();
      updateTriangleInfo();
      document.getElementById('imageUpload').value='';
    });

    document.getElementById('downloadPNG').addEventListener('click', ()=>{
      const link = document.createElement('a');
      link.download = 'triangle_visual.png';
      link.href = triangleCanvas.toDataURL('image/png');
      link.click();
    });

    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    function redrawImage(){
      if (!img) return;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
      points.forEach((p,i)=> drawPoint(p,i));
      if (points.length>=2){
        ctx.beginPath();
        ctx.moveTo(points[0].x,points[0].y);
        for (let i=1;i<points.length;i++) ctx.lineTo(points[i].x,points[i].y);
        if (points.length===3) ctx.closePath();
        ctx.strokeStyle='rgba(222,45,38,0.9)';
        ctx.lineWidth=2;
        ctx.stroke();
      }
    }

    function drawPoint(p,i){
      ctx.beginPath();
      ctx.arc(p.x,p.y,6,0,Math.PI*2);
      ctx.fillStyle=['#e11d48','#06b6d4','#7c3aed'][i%3];
      ctx.fill();
      ctx.font='14px Arial';
      ctx.fillStyle='#111';
      ctx.fillText(String.fromCharCode(65+i),p.x+10,p.y-10);
    }

    function renderPointsList(){
      pointsList.innerHTML = '';
      if (points.length===0){
        pointsList.innerHTML = '<tr><td colspan="3" class="small">아직 선택된 점이 없습니다.</td></tr>';
        return;
      }
      points.forEach((p,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${String.fromCharCode(65+i)}</td><td>${p.x.toFixed(1)}</td><td>${p.y.toFixed(1)}</td>`;
        pointsList.appendChild(tr);
      });
    }

    function distance(p1,p2){
      return Math.hypot(p2.x-p1.x,p2.y-p1.y);
    }

    function updateTriangleInfo(){
      cosLawResult.innerHTML=''; 
      sineLawResult.innerHTML='';

      if (points.length<3){
        triangleInfo.textContent = `더 많은 점을 선택하세요. 현재 ${points.length}/3`;
        triangleCtx.clearRect(0,0,triangleCanvas.width,triangleCanvas.height);
        return;
      }

      const A=points[0], B=points[1], C=points[2];
      const a = distance(B,C);
      const b = distance(A,C);
      const c = distance(A,B);

      const angleA = Math.acos(clamp((b*b + c*c - a*a)/(2*b*c),-1,1));
      const angleB = Math.acos(clamp((a*a + c*c - b*b)/(2*a*c),-1,1));
      const angleC = Math.acos(clamp((a*a + b*b - c*c)/(2*a*b),-1,1));

      const degA = angleA*180/Math.PI;
      const degB = angleB*180/Math.PI;
      const degC = angleC*180/Math.PI;

      triangleInfo.innerHTML = `
        <table>
          <tr><th>요소</th><th>값</th></tr>
          <tr><td>변 a (BC)</td><td>${a.toFixed(2)} px</td></tr>
          <tr><td>변 b (AC)</td><td>${b.toFixed(2)} px</td></tr>
          <tr><td>변 c (AB)</td><td>${c.toFixed(2)} px</td></tr>
          <tr><td>각 A</td><td>${degA.toFixed(2)}°</td></tr>
          <tr><td>각 B</td><td>${degB.toFixed(2)}°</td></tr>
          <tr><td>각 C</td><td>${degC.toFixed(2)}°</td></tr>
        </table>
      `;

      cosLawResult.innerHTML = `<strong>코사인법칙</strong><div class="small">a/sin(A) = ${(a/Math.sin(angleA)).toFixed(2)}</div>`;
      sineLawResult.innerHTML = `<strong>사인법칙</strong><div class="small">a/sin(A) = ${(a/Math.sin(angleA)).toFixed(2)}</div>`;

      drawTriangleVisualization(a,b,c,angleC);
    }

    function clamp(v,min,max){
      return Math.min(max,Math.max(min,v));
    }

    /* ===============================
       ✔ 새 버전: 삼각형 완전 중앙 정렬
       =============================== */
    function drawTriangleVisualization(a, b, c, angleC){
      triangleCtx.clearRect(0,0,triangleCanvas.width,triangleCanvas.height);
      
      const pad = 20;
      const W = triangleCanvas.width - pad*2;
      const H = triangleCanvas.height - pad*2;

      const scale = Math.min(W, H) / Math.max(a, b, c) * 0.9;

      // 임시 좌표 (원점 기준)
      const xA = 0, yA = 0;
      const xB = c * scale, yB = 0;
      const xC = b * scale * Math.cos(angleC);
      const yC = - b * scale * Math.sin(angleC);

      const minX = Math.min(xA,xB,xC);
      const maxX = Math.max(xA,xB,xC);
      const minY = Math.min(yA,yB,yC);
      const maxY = Math.max(yA,yB,yC);

      const offsetX = (triangleCanvas.width - (maxX - minX)) / 2 - minX;
      const offsetY = (triangleCanvas.height - (maxY - minY)) / 2 - minY;

      const A = {x:xA+offsetX, y:yA+offsetY};
      const B = {x:xB+offsetX, y:yB+offsetY};
      const C = {x:xC+offsetX, y:yC+offsetY};

      triangleCtx.beginPath();
      triangleCtx.moveTo(A.x,A.y);
      triangleCtx.lineTo(B.x,B.y);
      triangleCtx.lineTo(C.x,C.y);
      triangleCtx.closePath();
      triangleCtx.lineWidth = 2;
      triangleCtx.strokeStyle = '#0f766e';
      triangleCtx.stroke();

      // 점 + 텍스트
      [{p:A,l:'A'}, {p:B,l:'B'}, {p:C,l:'C'}].forEach(obj=>{
        triangleCtx.beginPath();
        triangleCtx.arc(obj.p.x,obj.p.y,5,0,Math.PI*2);
        triangleCtx.fillStyle='#0f766e';
        triangleCtx.fill();
        triangleCtx.font='13px Arial';
        triangleCtx.fillStyle='#0f172a';
        triangleCtx.fillText(obj.l,obj.p.x+8,obj.p.y-8);
      });

      triangleCtx.font='12px Arial';
      triangleCtx.fillStyle='#0f172a';
      triangleCtx.fillText(`a=${a.toFixed(1)}`, (B.x + C.x)/2, (B.y + C.y)/2 - 6);
      triangleCtx.fillText(`b=${b.toFixed(1)}`, (A.x + C.x)/2, (A.y + C.y)/2 - 6);
      triangleCtx.fillText(`c=${c.toFixed(1)}`, (A.x + B.x)/2, (A.y + B.y)/2 + 14);
    }

    /* 코사인/사인 계산기 */
    document.getElementById('calcAngles').addEventListener('click', ()=>{
      const a=parseFloat(sideA1.value);
      const b=parseFloat(sideB1.value);
      const c=parseFloat(sideC1.value);
      if (![a,b,c].every(v=>!isNaN(v))) return alert('세 변을 입력하세요.');

      const A = Math.acos(clamp((b*b + c*c - a*a)/(2*b*c),-1,1))*180/Math.PI;
      const B = Math.acos(clamp((a*a + c*c - b*b)/(2*a*c),-1,1))*180/Math.PI;
      const C = Math.acos(clamp((a*a + b*b - c*c)/(2*a*b),-1,1))*180/Math.PI;

      cosineLawCalcResult.innerHTML =
        `<div class="small">A=${A.toFixed(2)}° / B=${B.toFixed(2)}° / C=${C.toFixed(2)}°</div>`;
    });

    document.getElementById('calcSine').addEventListener('click', ()=>{
      const sideA=parseFloat(sineSideA.value);
      const angleA=parseFloat(sineAngleA.value);
      const sideB=parseFloat(sineSideB.value);
      const angleB=parseFloat(sineAngleB.value);
      const sideC=parseFloat(sineSideC.value);
      const angleC=parseFloat(sineAngleC.value);

      const items=[];
      if(!isNaN(sideA)&&!isNaN(angleA)) items.push(sideA/Math.sin(angleA*Math.PI/180));
      if(!isNaN(sideB)&&!isNaN(angleB)) items.push(sideB/Math.sin(angleB*Math.PI/180));
      if(!isNaN(sideC)&&!isNaN(angleC)) items.push(sideC/Math.sin(angleC*Math.PI/180));

      if(items.length===0) return alert("최소 한 쌍 입력");

      const ratio = items.reduce((s,v)=>s+v,0)/items.length;

      let out = `<div class="small">비율 = ${ratio.toFixed(3)}</div>`;
      if(isNaN(sideA)&&!isNaN(angleA)) out += `<div class="small">a=${(ratio*Math.sin(angleA*Math.PI/180)).toFixed(2)}</div>`;
      if(isNaN(sideB)&&!isNaN(angleB)) out += `<div class="small">b=${(ratio*Math.sin(angleB*Math.PI/180)).toFixed(2)}</div>`;
      if(isNaN(sideC)&&!isNaN(angleC)) out += `<div class="small">c=${(ratio*Math.sin(angleC*Math.PI/180)).toFixed(2)}</div>`;

      sineLawCalcResult.innerHTML = out;
    });

  </script>
</body>
</html>
